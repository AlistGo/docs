import{a7 as P,a8 as U,a9 as x,d as z,O as l,X as b,Z as A,_ as O,$ as v,o as g,g as r,a as n,c as j,a0 as y,f as i,a2 as Q,a1 as q}from"./app-X60whWqS.js";import{N as M}from"./Checkbox-CDE7ykvu.js";import{B as R}from"./Button-C0MxfZpQ.js";import{N as T}from"./Input-Bk7AWBWY.js";import{N as L}from"./Image-DuuTWMly.js";import{N as E}from"./Alert-CNrB-1Gq.js";function G(){const f=U(x,null);return f===null&&P("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),f}const w="https://alist.nn.ci/tool/aliyundrive/callback",B="76917ccccd4441c39457a04f6084fb2f",V=z({__name:"Request",setup(f,{expose:t}){t();function S(){const a=new URL("https://open.aliyundrive.com/oauth/authorize");a.searchParams.set("client_id",o.value?u.value:B),a.searchParams.set("redirect_uri",w),a.searchParams.set("scope","user:base,file:all:read,file:all:write"),a.searchParams.set("response_type","code"),a.searchParams.set("state",window.btoa(o.value?`${u.value}::${c.value}`:"::")),a.searchParams.set("relogin","true"),window.open(a.toString(),"_blank")}const e=l(),m=l(!1),u=l(""),c=l(""),o=l(!1);async function s(){try{m.value=!0;const d=await(await fetch(b()+"/alist/ali_open/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o.value?{client_id:u.value,client_secret:c.value}:{})})).json();e.value=d}catch(a){console.log(a),e.value={error:"error",qrCodeUrl:"",sid:""}}finally{m.value=!1}}const h=l(),_=l(!1),N=G();async function I(){var a;try{_.value=!0;const p=await(await fetch(`${b()}/proxy/https://open.aliyundrive.com/oauth/qrcode/${(a=e.value)==null?void 0:a.sid}/status`)).json();if(h.value=p,p.status==="LoginSuccess"){const C=new URL(w);C.searchParams.set("code",p.authCode),window.open(C.toString(),"_blank")}else N.warning(p.status)}catch(d){console.log(d),N.error(String(d))}finally{_.value=!1}}const k={alist_redirect_uri:w,app_id:B,goGet:S,qrcode:e,gettingQrCode:m,client_id:u,client_secret:c,useMyOwn:o,getQrCode:s,scanStatus:h,gettingScanStatus:_,message:N,haveScan:I,get NButton(){return R},get NSpace(){return A},get NAlert(){return E},get NImage(){return L},get NCheckbox(){return M},get NInput(){return T}};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}});function D(f,t,S,e,m,u){return g(),v(e.NSpace,{vertical:"",size:"large"},{default:r(()=>{var c,o;return[n(e.NCheckbox,{checked:e.useMyOwn,"onUpdate:checked":t[0]||(t[0]=s=>e.useMyOwn=s),size:"large"},{default:r(()=>t[3]||(t[3]=[i("Use my own client")])),_:1},8,["checked"]),e.useMyOwn?(g(),j(Q,{key:0},[n(e.NInput,{size:"large",value:e.client_id,"onUpdate:value":t[1]||(t[1]=s=>e.client_id=s),placeholder:"client_id"},null,8,["value"]),n(e.NInput,{size:"large",value:e.client_secret,"onUpdate:value":t[2]||(t[2]=s=>e.client_secret=s),placeholder:"client_secret"},null,8,["value"])],64)):y("",!0),n(e.NButton,{size:"large",type:"primary",onClick:e.goGet,block:""},{default:r(()=>t[4]||(t[4]=[i("Go to login")])),_:1}),n(e.NButton,{size:"large",type:"info",onClick:e.getQrCode,block:"",loading:e.gettingQrCode,disabled:!!e.qrcode},{default:r(()=>t[5]||(t[5]=[i("Scan QrCode ")])),_:1},8,["loading","disabled"]),(c=e.qrcode)!=null&&c.error?(g(),v(e.NAlert,{key:1,title:"Error",type:"error"},{default:r(()=>[i(q(e.qrcode.error),1)]),_:1})):y("",!0),(o=e.qrcode)!=null&&o.qrCodeUrl?(g(),v(e.NSpace,{key:2,vertical:""},{default:r(()=>[n(e.NSpace,{justify:"center"},{default:r(()=>[n(e.NImage,{width:"300",src:e.qrcode.qrCodeUrl},null,8,["src"])]),_:1}),n(e.NAlert,{title:"Scan the QrCode",type:"info"},{default:r(()=>t[6]||(t[6]=[i("Use AliyunDrive APP To Scan Then Click the Button Below")])),_:1}),n(e.NButton,{size:"large",onClick:e.haveScan,type:"info",block:"",loading:e.gettingScanStatus},{default:r(()=>t[7]||(t[7]=[i("I have scan")])),_:1},8,["loading"])]),_:1})):y("",!0),e.scanStatus&&e.scanStatus.status!=="LoginSuccess"?(g(),v(e.NAlert,{key:3,title:"Warning",type:"warning"},{default:r(()=>[i(q(e.scanStatus.status),1)]),_:1})):y("",!0)]}),_:1})}const H=O(V,[["render",D],["__scopeId","data-v-bbd7adf5"],["__file","Request.vue"]]);export{H as R};
