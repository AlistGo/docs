import{d as x,L as a,M as N,O as T,_ as b,P as n,o as u,g as t,Q as i,f as s,R as y,a as l,e as C}from"./app-3Qodj0KA.js";import{N as w}from"./Input-m7prhmiJ.js";import{N as A}from"./Alert-Cgbv7d6K.js";import{B as I}from"./Button-nLqZTu8-.js";import{N as R}from"./Image-D9-mBvSa.js";const q=x({__name:"Token",setup(B,{expose:r}){r();const c=a(""),e=a({uid:"",time:0,qrcode:"",sign:""}),d=a(""),f=a(""),_=a(!1);async function F(){_.value=!0,d.value="";const o=await(await fetch(N("/alist/115/auth_device_code"))).json();if(_.value=!1,o.error){d.value=o.error;return}c.value=o.code_verifier,e.value=o.resp;const p=new URL(N("/qr"));p.searchParams.set("text",e.value.qrcode),f.value=p.toString()}const g=a(!1),k=a(""),v=a({access_token:"",refresh_token:"",expires_in:0});async function S(){g.value=!0,k.value="";const o=await(await fetch(N("/alist/115/get_token"),{method:"POST",body:JSON.stringify({code_verifier:c.value,uid:e.value.uid})})).json();if(g.value=!1,o.error){k.value=o.error;return}v.value=o.resp}const m={codeVerifier:c,codeResp:e,error1:d,qrCode:f,gettingQrCode:_,generateQrcode:F,gettingToken:g,error2:k,tokenResp:v,getToken:S,get NButton(){return I},get NSpace(){return T},get NImage(){return R},get NAlert(){return A},get NInput(){return w}};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}});function P(B,r,c,e,d,f){return u(),n(e.NSpace,{vertical:"",size:"large"},{default:t(()=>[e.codeVerifier?i("",!0):(u(),n(e.NButton,{key:0,block:"",type:"primary",onClick:e.generateQrcode,loading:e.gettingQrCode},{default:t(()=>r[0]||(r[0]=[s("生成二维码")])),_:1},8,["loading"])),e.error1?(u(),n(e.NAlert,{key:1,title:"Error",type:"error"},{default:t(()=>[s(y(e.error1),1)]),_:1})):i("",!0),e.qrCode?(u(),n(e.NSpace,{key:2,vertical:""},{default:t(()=>[l(e.NSpace,{justify:"center"},{default:t(()=>[l(e.NImage,{width:"300",src:e.qrCode},null,8,["src"])]),_:1}),l(e.NAlert,{title:"扫描二维码",type:"info"},{default:t(()=>r[1]||(r[1]=[s("使用 115 APP 扫描二维码，然后点击下方按钮")])),_:1}),l(e.NButton,{size:"large",onClick:e.getToken,type:"info",block:"",loading:e.gettingToken},{default:t(()=>r[2]||(r[2]=[s("已扫码")])),_:1},8,["loading"]),e.error2?(u(),n(e.NAlert,{key:0,title:"Error",type:"error"},{default:t(()=>[s(y(e.error2),1)]),_:1})):i("",!0)]),_:1})):i("",!0),e.tokenResp.refresh_token?(u(),n(e.NSpace,{key:3,vertical:""},{default:t(()=>[r[3]||(r[3]=C("b",null,"refresh_token:",-1)),l(e.NInput,{type:"textarea",autosize:"",readonly:"",value:e.tokenResp.refresh_token},null,8,["value"]),r[4]||(r[4]=C("b",null,"access_token:",-1)),l(e.NInput,{type:"textarea",autosize:"",readonly:"",value:e.tokenResp.access_token},null,8,["value"])]),_:1})):i("",!0)]),_:1})}const h=b(q,[["render",P],["__file","Token.vue"]]);export{h as T};
