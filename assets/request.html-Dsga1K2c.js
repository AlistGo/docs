import{aF as R,a9 as B,aG as I,d as T,O as l,V as b,$ as z,_ as P,a0 as y,o as p,g as a,a as n,c as x,a1 as v,f as c,af as O,Y as q,r as j}from"./app-DQ_iLqVF.js";import{N as G}from"./Checkbox-KHYZfYbO.js";import{B as M}from"./Button-BwwjmgQe.js";import{N as Q}from"./Input-PJtdS9Oh.js";import{N as L}from"./Image-Dn4OPrZb.js";import{N as D}from"./Alert-Cio5VXQ-.js";import"./browser-CDtCWR8e.js";function H(){const u=B(I,null);return u===null&&R("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),u}const S="https://alist.nn.ci/tool/aliyundrive/callback",A="76917ccccd4441c39457a04f6084fb2f",V=T({__name:"Request",setup(u,{expose:t}){t();function d(){const r=new URL("https://open.aliyundrive.com/oauth/authorize");r.searchParams.set("client_id",s.value?m.value:A),r.searchParams.set("redirect_uri",S),r.searchParams.set("scope","user:base,file:all:read,file:all:write"),r.searchParams.set("response_type","code"),r.searchParams.set("state",window.btoa(s.value?`${m.value}::${o.value}`:"::")),r.searchParams.set("relogin","true"),window.open(r.toString(),"_blank")}const e=l(),f=l(!1),m=l(""),o=l(""),s=l(!1);async function i(){try{f.value=!0;const g=await(await fetch(b()+"/alist/ali_open/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s.value?{client_id:m.value,client_secret:o.value}:{})})).json();e.value=g}catch(r){console.log(r),e.value={error:"error",qrCodeUrl:"",sid:""}}finally{f.value=!1}}const w=l(),h=l(!1),N=H();async function U(){var r;try{h.value=!0;const _=await(await fetch(`${b()}/proxy/https://open.aliyundrive.com/oauth/qrcode/${(r=e.value)==null?void 0:r.sid}/status`)).json();if(w.value=_,_.status==="LoginSuccess"){const C=new URL(S);C.searchParams.set("code",_.authCode),window.open(C.toString(),"_blank")}else N.warning(_.status)}catch(g){console.log(g),N.error(String(g))}finally{h.value=!1}}const k={alist_redirect_uri:S,app_id:A,goGet:d,qrcode:e,gettingQrCode:f,client_id:m,client_secret:o,useMyOwn:s,getQrCode:i,scanStatus:w,gettingScanStatus:h,message:N,haveScan:U,get NButton(){return M},get NSpace(){return z},get NAlert(){return D},get NImage(){return L},get NCheckbox(){return G},get NInput(){return Q}};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}});function E(u,t,d,e,f,m){return p(),y(e.NSpace,{vertical:"",size:"large"},{default:a(()=>{var o,s;return[n(e.NCheckbox,{checked:e.useMyOwn,"onUpdate:checked":t[0]||(t[0]=i=>e.useMyOwn=i),size:"large"},{default:a(()=>t[3]||(t[3]=[c("Use my own client")])),_:1},8,["checked"]),e.useMyOwn?(p(),x(O,{key:0},[n(e.NInput,{size:"large",value:e.client_id,"onUpdate:value":t[1]||(t[1]=i=>e.client_id=i),placeholder:"client_id"},null,8,["value"]),n(e.NInput,{size:"large",value:e.client_secret,"onUpdate:value":t[2]||(t[2]=i=>e.client_secret=i),placeholder:"client_secret"},null,8,["value"])],64)):v("",!0),n(e.NButton,{size:"large",type:"primary",onClick:e.goGet,block:""},{default:a(()=>t[4]||(t[4]=[c("Go to login")])),_:1}),n(e.NButton,{size:"large",type:"info",onClick:e.getQrCode,block:"",loading:e.gettingQrCode,disabled:!!e.qrcode},{default:a(()=>t[5]||(t[5]=[c("Scan QrCode ")])),_:1},8,["loading","disabled"]),(o=e.qrcode)!=null&&o.error?(p(),y(e.NAlert,{key:1,title:"Error",type:"error"},{default:a(()=>[c(q(e.qrcode.error),1)]),_:1})):v("",!0),(s=e.qrcode)!=null&&s.qrCodeUrl?(p(),y(e.NSpace,{key:2,vertical:""},{default:a(()=>[n(e.NSpace,{justify:"center"},{default:a(()=>[n(e.NImage,{width:"300",src:e.qrcode.qrCodeUrl},null,8,["src"])]),_:1}),n(e.NAlert,{title:"Scan the QrCode",type:"info"},{default:a(()=>t[6]||(t[6]=[c("Use AliyunDrive APP To Scan Then Click the Button Below")])),_:1}),n(e.NButton,{size:"large",onClick:e.haveScan,type:"info",block:"",loading:e.gettingScanStatus},{default:a(()=>t[7]||(t[7]=[c("I have scan")])),_:1},8,["loading"])]),_:1})):v("",!0),e.scanStatus&&e.scanStatus.status!=="LoginSuccess"?(p(),y(e.NAlert,{key:3,title:"Warning",type:"warning"},{default:a(()=>[c(q(e.scanStatus.status),1)]),_:1})):v("",!0)]}),_:1})}const F=P(V,[["render",E],["__scopeId","data-v-bbd7adf5"],["__file","Request.vue"]]),Z=T({__name:"request.html",setup(u,{expose:t}){t();const d={get Request(){return F}};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}});function J(u,t,d,e,f,m){const o=j("NaiveClient");return p(),x("div",null,[n(o,null,{default:a(()=>[n(e.Request)]),_:1})])}const re=P(Z,[["render",J],["__file","request.html.vue"]]),ae=JSON.parse('{"path":"/tool/aliyundrive/request.html","title":"Get Aliyundrive Refresh Token","lang":"en-US","frontmatter":{"title":"Get Aliyundrive Refresh Token","toc":false,"head":[["meta",{"property":"og:url","content":"https://alist.nn.ci/tool/aliyundrive/request.html"}],["meta",{"property":"og:site_name","content":"AList Docs"}],["meta",{"property":"og:title","content":"Get Aliyundrive Refresh Token"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2023-02-23T11:07:38.000Z"}],["meta",{"property":"article:modified_time","content":"2023-02-23T11:07:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Get Aliyundrive Refresh Token\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-02-23T11:07:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Andy Hsu\\",\\"url\\":\\"https://i.nn.ci\\"}]}"]]},"headers":[],"git":{"createdTime":1676628274000,"updatedTime":1677150458000,"contributors":[{"name":"Andy Hsu","username":"Andy Hsu","email":"i@nn.ci","commits":2,"url":"https://github.com/Andy Hsu"}]},"readingTime":{"minutes":0.07,"words":20},"filePathRelative":"tool/aliyundrive/request.md","localizedDate":"February 17, 2023"}');export{re as comp,ae as data};
