import{d as C,j as M,c as i,u as r,o as n,w as l,e as a,t as d,f as s,b as c,a as k,N as m,a3 as T,k as z,g as b,_ as B}from"./app-BPY7lyif.js";import{B as P}from"./Button-Bkh4efJ8.js";import{N as y}from"./Alert-o_7ljX_h.js";import{N as h}from"./Input-C0fQRgwX.js";const U={key:2},j=C({__name:"Callback",setup(w){const u=new URL(window.location.href),g=u.searchParams.get("code"),p=u.searchParams.get("state"),f=u.searchParams.get("error"),v=u.searchParams.get("error_description"),e=M({refreshToken:"",accessToken:"",error1:"",errorMessage1:"",siteUrl:"",siteId:"",error2:"",errorMessage2:"",gettingSiteId:!1});g&&p&&!f&&(()=>{fetch(`${b()}/alist/onedrive/get_refresh_token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:g,client:p})}).then(o=>o.json()).then(o=>{if(console.log(o),o.error){e.error1=o.error,e.errorMessage1=o.error_description;return}e.refreshToken=o.refresh_token,e.accessToken=o.access_token})})();const[I,N,_]=atob(p).split("::"),S=()=>{e.gettingSiteId=!0,fetch(`${b()}/alist/onedrive/get_site_id`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site_url:e.siteUrl,access_token:e.accessToken,zone:_})}).then(o=>(e.gettingSiteId=!1,o.json())).then(o=>{if(o.error){e.error2=o.error,e.errorMessage2=o.error.message;return}e.siteId=o.id})};return(o,t)=>!r(g)||!r(p)||r(f)?(n(),i(r(y),{key:0,title:r(f)||"Error",type:"error"},{default:l(()=>[a(d(r(v)),1)]),_:1},8,["title"])):(n(),i(r(m),{key:1,vertical:"",size:"large"},{default:l(()=>[s("p",null,[t[1]||(t[1]=s("b",null,"client_id: ",-1)),a(d(r(I)),1)]),s("p",null,[t[2]||(t[2]=s("b",null,"client_secret: ",-1)),a(d(r(N)),1)]),s("p",null,[t[3]||(t[3]=s("b",null,"zone: ",-1)),a(d(r(_)),1)]),t[8]||(t[8]=s("p",null,[s("b",null,"redirect_uri: "),a("https://alistgo.com/tool/onedrive/callback")],-1)),e.error1||e.errorMessage1?(n(),i(r(y),{key:0,title:e.error1,type:"error"},{default:l(()=>[a(d(e.errorMessage1),1)]),_:1},8,["title"])):c("",!0),k(r(m),{vertical:""},{default:l(()=>[t[4]||(t[4]=s("b",null,"refresh_token:",-1)),!e.refreshToken&&!e.errorMessage1?(n(),i(r(T),{key:0})):(n(),i(r(h),{key:1,type:"textarea",autosize:"",readonly:"",value:e.refreshToken},null,8,["value"]))]),_:1}),e.accessToken?(n(),i(r(m),{key:1,vertical:"",size:"large"},{default:l(()=>[t[7]||(t[7]=s("h3",null,"Get sharepoint site ID",-1)),e.error2||e.errorMessage2?(n(),i(r(y),{key:0,title:e.error2,type:"error"},{default:l(()=>[a(d(e.errorMessage2),1)]),_:1},8,["title"])):c("",!0),k(r(h),{placeholder:"input site url (https://xx.sharepoint.xx/sites/xx)",size:"large",value:e.siteUrl,"onUpdate:value":t[0]||(t[0]=x=>e.siteUrl=x)},null,8,["value"]),k(r(P),{type:"primary",size:"large",onClick:S},{default:l(()=>[...t[5]||(t[5]=[a("Get SiteID",-1)])]),_:1}),e.gettingSiteId?(n(),i(r(T),{key:1})):e.siteId?(n(),z("p",U,[t[6]||(t[6]=s("b",null,"site_id: ",-1)),a(d(e.siteId),1)])):c("",!0)]),_:1})):c("",!0)]),_:1}))}}),J=B(j,[["__scopeId","data-v-08517cd2"]]);export{J as C};
