import{d as N,aa as I,V as b,ag as x,ac as A,_ as v,ad as s,o as i,g as d,f as l,Y as c,e as o,ae as u,a as _,c as S,r as O}from"./app-K34Aos0E.js";import{B as M}from"./Button-CkIOIhC-.js";import{N as P}from"./Input-04jHTtK1.js";import{N as z}from"./Alert-CKlm5BJY.js";import"./browser-CYFPQBQD.js";const B=N({__name:"Callback",setup(f,{expose:t}){t();const n=new URL(window.location.href),e=n.searchParams.get("code"),p=n.searchParams.get("state"),g=n.searchParams.get("error"),m=n.searchParams.get("error_description"),a=I({refreshToken:"",accessToken:"",error1:"",errorMessage1:"",siteUrl:"",siteId:"",error2:"",errorMessage2:"",gettingSiteId:!1}),k=()=>{fetch(`${b()}/alist/onedrive/get_refresh_token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,client:p})}).then(r=>r.json()).then(r=>{if(console.log(r),r.error){a.error1=r.error,a.errorMessage1=r.error_description;return}a.refreshToken=r.refresh_token,a.accessToken=r.access_token})};e&&p&&!g&&k();const[T,C,y]=atob(p).split("::"),h={url:n,code:e,client:p,error:g,error_description:m,data:a,getToken:k,client_id:T,client_secret:C,zone:y,getSiteId:()=>{a.gettingSiteId=!0,fetch(`${b()}/alist/onedrive/get_site_id`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site_url:a.siteUrl,access_token:a.accessToken,zone:y})}).then(r=>(a.gettingSiteId=!1,r.json())).then(r=>{if(r.error){a.error2=r.error,a.errorMessage2=r.error.message;return}a.siteId=r.id})},get NAlert(){return z},get NButton(){return M},get NInput(){return P},get NSpace(){return A},get NSpin(){return x}};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}}),U={key:2};function j(f,t,n,e,p,g){return!e.code||!e.client||e.error?(i(),s(e.NAlert,{key:0,title:e.error||"Error",type:"error"},{default:d(()=>[l(c(e.error_description),1)]),_:1},8,["title"])):(i(),s(e.NSpace,{key:1,vertical:"",size:"large"},{default:d(()=>[o("p",null,[t[1]||(t[1]=o("b",null,"client_id: ",-1)),l(c(e.client_id),1)]),o("p",null,[t[2]||(t[2]=o("b",null,"client_secret: ",-1)),l(c(e.client_secret),1)]),o("p",null,[t[3]||(t[3]=o("b",null,"zone: ",-1)),l(c(e.zone),1)]),t[8]||(t[8]=o("p",null,[o("b",null,"redirect_uri: "),l("https://alist.nn.ci/tool/onedrive/callback")],-1)),e.data.error1||e.data.errorMessage1?(i(),s(e.NAlert,{key:0,title:e.data.error1,type:"error"},{default:d(()=>[l(c(e.data.errorMessage1),1)]),_:1},8,["title"])):u("",!0),_(e.NSpace,{vertical:""},{default:d(()=>[t[4]||(t[4]=o("b",null,"refresh_token:",-1)),!e.data.refreshToken&&!e.data.errorMessage1?(i(),s(e.NSpin,{key:0})):(i(),s(e.NInput,{key:1,type:"textarea",autosize:"",readonly:"",value:e.data.refreshToken},null,8,["value"]))]),_:1}),e.data.accessToken?(i(),s(e.NSpace,{key:1,vertical:"",size:"large"},{default:d(()=>[t[7]||(t[7]=o("h3",null,"Get sharepoint site ID",-1)),e.data.error2||e.data.errorMessage2?(i(),s(e.NAlert,{key:0,title:e.data.error2,type:"error"},{default:d(()=>[l(c(e.data.errorMessage2),1)]),_:1},8,["title"])):u("",!0),_(e.NInput,{placeholder:"input site url (https://xx.sharepoint.xx/sites/xx)",size:"large",value:e.data.siteUrl,"onUpdate:value":t[0]||(t[0]=m=>e.data.siteUrl=m)},null,8,["value"]),_(e.NButton,{type:"primary",size:"large",onClick:e.getSiteId},{default:d(()=>t[5]||(t[5]=[l("Get SiteID")])),_:1}),e.data.gettingSiteId?(i(),s(e.NSpin,{key:1})):e.data.siteId?(i(),S("p",U,[t[6]||(t[6]=o("b",null,"site_id: ",-1)),l(c(e.data.siteId),1)])):u("",!0)]),_:1})):u("",!0)]),_:1}))}const R=v(B,[["render",j],["__scopeId","data-v-109d5915"],["__file","Callback.vue"]]),w=N({__name:"callback.html",setup(f,{expose:t}){t();const n={get Callback(){return R}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}});function D(f,t,n,e,p,g){const m=O("NaiveClient");return i(),S("div",null,[_(m,null,{default:d(()=>[_(e.Callback)]),_:1})])}const L=v(w,[["render",D],["__file","callback.html.vue"]]),F=JSON.parse('{"path":"/tool/onedrive/callback.html","title":"Onedrive Refresh Token Callback","lang":"en-US","frontmatter":{"title":"Onedrive Refresh Token Callback","toc":false,"head":[["meta",{"property":"og:url","content":"https://alist.nn.ci/tool/onedrive/callback.html"}],["meta",{"property":"og:site_name","content":"AList Docs"}],["meta",{"property":"og:title","content":"Onedrive Refresh Token Callback"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2023-02-16T12:31:34.000Z"}],["meta",{"property":"article:modified_time","content":"2023-02-16T12:31:34.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Onedrive Refresh Token Callback\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-02-16T12:31:34.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Andy Hsu\\",\\"url\\":\\"https://i.nn.ci\\"}]}"]]},"headers":[],"git":{"createdTime":1676541915000,"updatedTime":1676550694000,"contributors":[{"name":"Andy Hsu","username":"Andy Hsu","email":"i@nn.ci","commits":3,"url":"https://github.com/Andy Hsu"}]},"readingTime":{"minutes":0.07,"words":20},"filePathRelative":"tool/onedrive/callback.md","localizedDate":"February 16, 2023"}');export{L as comp,F as data};
