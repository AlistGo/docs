import{_ as c}from"./updocker-yVuyGOuG.js";import{_ as p,r,o as u,c as h,b as a,e,a as l,w as s,f as i}from"./app-UOsXPusz.js";const k={},m=i(`<h1 id="使用-docker" tabindex="-1"><a class="header-anchor" href="#使用-docker" aria-hidden="true">#</a> 使用 Docker</h1><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> <strong>安装</strong></h2><h4 id="docker-cli" tabindex="-1"><a class="header-anchor" href="#docker-cli" aria-hidden="true">#</a> <strong>docker cli</strong></h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--restart</span><span class="token operator">=</span>unless-stopped <span class="token parameter variable">-v</span> /etc/alist:/opt/alist/data <span class="token parameter variable">-p</span> <span class="token number">5244</span>:5244 <span class="token parameter variable">-e</span> <span class="token assign-left variable">PUID</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">PGID</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">UMASK</span><span class="token operator">=</span>022 <span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token string">&quot;alist&quot;</span> xhofe/alist:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="docker-compose" tabindex="-1"><a class="header-anchor" href="#docker-compose" aria-hidden="true">#</a> <strong>docker compose</strong></h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.3&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">alist</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&#39;xhofe/alist:beta&#39;</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> alist
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;/etc/alist:/opt/alist/data&#39;</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;5244:5244&#39;</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PUID=0
      <span class="token punctuation">-</span> PGID=0
      <span class="token punctuation">-</span> UMASK=022
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="环境变量" tabindex="-1"><a class="header-anchor" href="#环境变量" aria-hidden="true">#</a> <strong>环境变量</strong></h4>`,7),b=a("thead",null,[a("tr",null,[a("th",{style:{"text-align":"left"}},"名称"),a("th",{style:{"text-align":"left"}},"默认值"),a("th",null,"说明")])],-1),v=a("tr",null,[a("td",{style:{"text-align":"left"}},[a("code",null,"PUID")]),a("td",{style:{"text-align":"left"}},[a("code",null,"0")]),a("td",null,"运行身份 UID")],-1),g=a("tr",null,[a("td",{style:{"text-align":"left"}},[a("code",null,"PGID")]),a("td",{style:{"text-align":"left"}},[a("code",null,"0")]),a("td",null,"运行身份 GID")],-1),f=a("td",{style:{"text-align":"left"}},[a("code",null,"UMASK")],-1),x=a("td",{style:{"text-align":"left"}},[a("code",null,"022")],-1),_={href:"https://en.wikipedia.org/wiki/Umask",target:"_blank",rel:"noopener noreferrer"},y=a("tr",null,[a("td",{style:{"text-align":"left"}},[a("code",null,"RUN_ARIA2")]),a("td",{style:{"text-align":"left"}}),a("td",null,[e("是否同时运行 ARIA2，当镜像含有 aria2 环境时默认为 "),a("code",null,"true"),e("，否则为 "),a("code",null,"false")])],-1),A=a("tr",null,[a("td",{style:{"text-align":"left"}},[a("code",null,"TZ")]),a("td",{style:{"text-align":"left"}}),a("td",null,[e("默认为 UTC 时区，如果你想指定时区，则可以设置此变量，例如："),a("code",null,"Asia/Shanghai")])],-1),I=a("h4",{id:"镜像版本",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#镜像版本","aria-hidden":"true"},"#"),e(),a("strong",null,"镜像版本")],-1),D=a("p",null,[e("稳定版："),a("code",null,"xhofe/alist:latest"),e(" 或指定本版，如 "),a("code",null,"xhofe/alist:v3.41.0"),e(),a("code",null,"xhofe/alist:v3.40.0")],-1),U={href:"https://hub.docker.com/r/xhofe/alist/tags",target:"_blank",rel:"noopener noreferrer"},P=i(`<p>开发版：<code>xhofe/alist:beta</code></p><p>预装环境镜像后缀:</p><table><thead><tr><th style="text-align:left;">后缀</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>aio</code></td><td>同时包含下列所有预装环境的镜像</td></tr><tr><td style="text-align:left;"><code>ffmpeg</code></td><td>预装 ffmpeg 的镜像，用于本地存储缩略图</td></tr><tr><td style="text-align:left;"><code>aria2</code></td><td>预装 aria2 的镜像，用于离线下载</td></tr></tbody></table><p>你可以在上述任意镜像标签后面，使用 <code>-</code> 符号附加后缀以切换到附带环境的镜像。如 <code>xhofe/alist:latest-aio</code> <code>xhofe/alist:beta-aria2</code> <code>xhofe/alist:v3.40.0-ffmpeg</code></p><p>如果使用预装 ffmpeg 镜像缩略图功能仍无法使用，请确认:</p><ul><li>使用的是本地存储</li><li>切换到网格视图</li><li>本地存储的缩略图开关开启</li><li>本地存储的缩略图缓存文件夹配置路径正确，例如 <code>data/thumbnail</code></li></ul><p>当使用预装 aria2 镜像时，可能会在 alist 的日志中看到类似错误：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ERRO[2022-11-20 12:05:19] error [unaligned 64-bit atomic operation] while run task  [download http://xxx.com/xxx.png to [/ftp](/)]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>解决方法是，如果是 CPU 架构是 64 位，可以尝试手动拉取 64 位镜像或重新构建容器。 如果是 CPU 架构是 32 位，目前尚无可用方案。</p><h2 id="查看管理员信息" tabindex="-1"><a class="header-anchor" href="#查看管理员信息" aria-hidden="true">#</a> <strong>查看管理员信息：</strong></h2><h4 id="低于v3-25-0版本" tabindex="-1"><a class="header-anchor" href="#低于v3-25-0版本" aria-hidden="true">#</a> <strong>低于v3.25.0版本</strong></h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> alist ./alist admin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="高于v3-25-0版本" tabindex="-1"><a class="header-anchor" href="#高于v3-25-0版本" aria-hidden="true">#</a> <strong>高于v3.25.0版本</strong></h4><p>3.25.0以上版本将密码改成加密方式存储的hash值，无法直接反算出密码，如果忘记了密码只能通过重新 <strong><code>随机生成</code></strong> 或者 <strong><code>手动设置</code></strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 随机生成一个密码</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> alist ./alist admin random
<span class="token comment"># 手动设置一个密码,\`NEW_PASSWORD\`是指你需要设置的密码</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> alist ./alist admin <span class="token builtin class-name">set</span> NEW_PASSWORD
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="更新" tabindex="-1"><a class="header-anchor" href="#更新" aria-hidden="true">#</a> <strong>更新</strong></h2><details class="hint-container details"><summary>docker-cli 更新</summary><ol><li><p>docker ps -a #查看容器(找Alist容器的ID)</p></li><li><p>docker stop ID #停止Alist运行,不然无法删除(这次Alist容器的ID是d429749a6e69，每一次安装都不一样自己看)</p></li><li><p>docker rm ID #删除Alist容器(数据还在只要你不手动删除)</p></li><li><p>docker pull xhofe/alist:latest</p></li><li><p><a href="#docker-cli">输入安装命令点击查看</a></p></li><li><p>更新好了 去看看吧..就这么简单</p></li></ol><p><strong>图片中丢了一步，是教程中的第四步....记得执行</strong><br><img src="`+c+'" alt="docker"></p></details><details class="hint-container details"><summary>docker-compose 更新</summary><ol><li>docker-compose pull</li><li>docker-compose up -d</li></ol></details><p>Q：我的版本是v3.x.x 怎么也升级不到最新版 <code>docker pull xhofe/alist:latest</code>拉取最新不行 改成docker-compose安装还是3.x.x版本</p><p>A：原因是你的docker设置了镜像，从镜像更新不到最新版本，改一下/etc/docker/daemon.json，删除&quot;registry-mirrors&quot;: [&quot;镜像加速器地址&quot;]</p><ul><li>删除若不行，可以考虑更换一个<code>镜像加速地址</code></li><li>或者简单粗暴：下载时将<code>xhofe/alist:latest</code> 替换为<code>xhofe/alist:v3.16.3</code>（指定版本，写教程时最新的是3.16.3）</li></ul><h3 id="编译镜像" tabindex="-1"><a class="header-anchor" href="#编译镜像" aria-hidden="true">#</a> <strong>编译镜像</strong></h3><p>安装 docker，克隆仓库后进入仓库根目录，无需其他准备</p>',23),S=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"docker"),e(" build "),a("span",{class:"token parameter variable"},"-t"),e(" xhofe/alist:latest "),a("span",{class:"token builtin class-name"},"."),e(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),N=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"docker"),e(" build "),a("span",{class:"token parameter variable"},"-t"),e(" xhofe/alist:latest-ffmpeg --build-arg "),a("span",{class:"token assign-left variable"},"INSTALL_FFMPEG"),a("span",{class:"token operator"},"="),e("true "),a("span",{class:"token builtin class-name"},"."),e(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),w=i('<p>可用 build args：</p><table><thead><tr><th style="text-align:left;"></th><th>说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>INSTALL_FFMPEG=true</code></td><td>安装 ffmpeg</td></tr><tr><td style="text-align:left;"><code>INSTALL_ARIA2=true</code></td><td>安装 aria2</td></tr></tbody></table>',2);function E(L,R){const o=r("ExternalLinkIcon"),d=r("Tabs");return u(),h("div",null,[m,a("table",null,[b,a("tbody",null,[v,g,a("tr",null,[f,x,a("td",null,[a("a",_,[e("https://en.wikipedia.org/wiki/Umask"),l(o)])])]),y,A])]),I,D,a("p",null,[e("最新镜像版本，请参阅 "),a("a",U,[e("https://hub.docker.com/r/xhofe/alist/tags"),l(o)])]),P,l(d,{id:"269",data:[{id:"basic"},{id:"build-arg"}],"tab-id":"Docker-build"},{title0:s(({value:t,isActive:n})=>[e("basic")]),title1:s(({value:t,isActive:n})=>[e("build-arg")]),tab0:s(({value:t,isActive:n})=>[S]),tab1:s(({value:t,isActive:n})=>[N]),_:1}),w])}const G=p(k,[["render",E],["__file","docker.html.vue"]]);export{G as default};
