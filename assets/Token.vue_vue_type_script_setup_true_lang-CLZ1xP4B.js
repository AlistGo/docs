import{d as T,r as a,c as l,o as s,w as r,a as o,b as u,u as t,e as n,t as C,N as c,f as b,g as N}from"./app-DOntmI05.js";import{N as w}from"./Input-BCL5AIsL.js";import{B as P}from"./Button-CiN3TMCR.js";import{N as x}from"./Alert-x2CnhZ-o.js";import{N as q}from"./Image-CqcTmaRl.js";const E=T({__name:"Token",setup(z){const p=a(""),k=a(""),m=a({uid:"",time:0,qrcode:"",sign:""}),i=a(""),y=a(""),_=a(!1);async function B(){_.value=!0,i.value="";const e=await(await fetch(N(`/alist/115/auth_device_code?app_id=${p.value}`))).json();if(_.value=!1,e.error){i.value=e.error;return}k.value=e.code_verifier,m.value=e.resp;const v=new URL(N("/qr"));v.searchParams.set("text",m.value.qrcode),y.value=v.toString()}const g=a(!1),d=a(""),f=a({access_token:"",refresh_token:"",expires_in:0});async function S(){g.value=!0,d.value="";const e=await(await fetch(N("/alist/115/get_token"),{method:"POST",body:JSON.stringify({code_verifier:k.value,uid:m.value.uid})})).json();if(g.value=!1,e.error){d.value=e.error;return}f.value=e.resp}return(V,e)=>(s(),l(t(c),{vertical:"",size:"large"},{default:r(()=>[o(t(w),{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=v=>p.value=v),placeholder:"APP ID, 不填则使用 Alist 默认提供"},null,8,["modelValue"]),k.value?u("",!0):(s(),l(t(P),{key:0,block:"",type:"primary",onClick:B,loading:_.value},{default:r(()=>e[1]||(e[1]=[n("生成二维码")])),_:1},8,["loading"])),i.value?(s(),l(t(x),{key:1,title:"Error",type:"error"},{default:r(()=>[n(C(i.value),1)]),_:1})):u("",!0),y.value?(s(),l(t(c),{key:2,vertical:""},{default:r(()=>[o(t(c),{justify:"center"},{default:r(()=>[o(t(q),{width:"300",src:y.value},null,8,["src"])]),_:1}),o(t(x),{title:"扫描二维码",type:"info"},{default:r(()=>e[2]||(e[2]=[n("使用 115 APP 扫描二维码，然后点击下方按钮")])),_:1}),o(t(P),{size:"large",onClick:S,type:"info",block:"",loading:g.value},{default:r(()=>e[3]||(e[3]=[n("已扫码")])),_:1},8,["loading"]),d.value?(s(),l(t(x),{key:0,title:"Error",type:"error"},{default:r(()=>[n(C(d.value),1)]),_:1})):u("",!0)]),_:1})):u("",!0),f.value.refresh_token?(s(),l(t(c),{key:3,vertical:""},{default:r(()=>[e[4]||(e[4]=b("b",null,"refresh_token:",-1)),o(t(w),{type:"textarea",autosize:"",readonly:"",value:f.value.refresh_token},null,8,["value"]),e[5]||(e[5]=b("b",null,"access_token:",-1)),o(t(w),{type:"textarea",autosize:"",readonly:"",value:f.value.access_token},null,8,["value"])]),_:1})):u("",!0)]),_:1}))}});export{E as _};
