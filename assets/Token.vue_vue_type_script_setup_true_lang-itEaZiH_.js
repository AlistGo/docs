import{d as V,r as a,c as o,o as l,w as r,a as n,u as t,b as u,t as x,N as c,e as s,f as C,g as m}from"./app-6tkzNA5U.js";import{B as b}from"./Button-DS6bN5lU.js";import{N as g}from"./Alert-C4_HXL4O.js";import{N as B}from"./Input-B_b6baF4.js";import{N as q}from"./Image-Dr_jV2NH.js";const E=V({__name:"Token",setup(z){const v=a(""),p=a({uid:"",time:0,qrcode:"",sign:""}),i=a(""),k=a(""),y=a(!1);async function S(){y.value=!0,i.value="";const e=await(await fetch(m("/alist/115/auth_device_code"))).json();if(y.value=!1,e.error){i.value=e.error;return}v.value=e.code_verifier,p.value=e.resp;const w=new URL(m("/qr"));w.searchParams.set("text",p.value.qrcode),k.value=w.toString()}const _=a(!1),d=a(""),f=a({access_token:"",refresh_token:"",expires_in:0});async function T(){_.value=!0,d.value="";const e=await(await fetch(m("/alist/115/get_token"),{method:"POST",body:JSON.stringify({code_verifier:v.value,uid:p.value.uid})})).json();if(_.value=!1,e.error){d.value=e.error;return}f.value=e.resp}return(N,e)=>(l(),o(t(c),{vertical:"",size:"large"},{default:r(()=>[v.value?n("",!0):(l(),o(t(b),{key:0,block:"",type:"primary",onClick:S,loading:y.value},{default:r(()=>e[0]||(e[0]=[u("生成二维码")])),_:1},8,["loading"])),i.value?(l(),o(t(g),{key:1,title:"Error",type:"error"},{default:r(()=>[u(x(i.value),1)]),_:1})):n("",!0),k.value?(l(),o(t(c),{key:2,vertical:""},{default:r(()=>[s(t(c),{justify:"center"},{default:r(()=>[s(t(q),{width:"300",src:k.value},null,8,["src"])]),_:1}),s(t(g),{title:"扫描二维码",type:"info"},{default:r(()=>e[1]||(e[1]=[u("使用 115 APP 扫描二维码，然后点击下方按钮")])),_:1}),s(t(b),{size:"large",onClick:T,type:"info",block:"",loading:_.value},{default:r(()=>e[2]||(e[2]=[u("已扫码")])),_:1},8,["loading"]),d.value?(l(),o(t(g),{key:0,title:"Error",type:"error"},{default:r(()=>[u(x(d.value),1)]),_:1})):n("",!0)]),_:1})):n("",!0),f.value.refresh_token?(l(),o(t(c),{key:3,vertical:""},{default:r(()=>[e[3]||(e[3]=C("b",null,"refresh_token:",-1)),s(t(B),{type:"textarea",autosize:"",readonly:"",value:f.value.refresh_token},null,8,["value"]),e[4]||(e[4]=C("b",null,"access_token:",-1)),s(t(B),{type:"textarea",autosize:"",readonly:"",value:f.value.access_token},null,8,["value"])]),_:1})):n("",!0)]),_:1}))}});export{E as _};
